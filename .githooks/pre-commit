#!/usr/bin/env bash
set -euo pipefail

echo "pre-commit: running cargo fmt -- --check"
cargo fmt --all -- --check

echo "pre-commit: running cargo clippy (deny warnings)"
if ! cargo clippy -V >/dev/null 2>&1; then
  echo "error: cargo clippy subcommand not available; install with 'rustup component add clippy'"
  exit 1
fi

# Clippy must pass with no warnings; do not allow fallback.
cargo clippy --workspace --all-targets --all-features -- -D warnings

echo "pre-commit: running cargo test"
cargo test --workspace --all-targets

echo "pre-commit: all checks passed"
